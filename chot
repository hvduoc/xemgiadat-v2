#!/bin/bash
# 1. Láº¥y dá»¯ liá»‡u má»›i nháº¥t
echo "ğŸ”„ Äang tÃ¬m hÃ ng vá»..."
git fetch origin --prune

# 2. TÃ¬m nhÃ¡nh copilot má»›i nháº¥t vá»«a Ä‘Æ°á»£c cáº­p nháº­t
LATEST_BRANCH=$(git for-each-ref --sort=-committerdate refs/remotes/origin/copilot/ --format="%(refname:short)" | head -n 1 | sed "s/origin\///")

if [ -z "$LATEST_BRANCH" ]; then
  echo "âŒ KhÃ´ng tÃ¬m tháº¥y nhÃ¡nh Agent nÃ o cáº£!"
  exit 1
fi

# 3. Há»i xÃ¡c nháº­n (Máº·c Ä‘á»‹nh lÃ  Äá»“ng Ã½)
echo "---------------------------------------"
echo "ğŸš€ PhÃ¡t hiá»‡n nhÃ¡nh má»›i nháº¥t: $LATEST_BRANCH"
echo "---------------------------------------"
read -p "â“ CHá»T ÄÆ N nhÃ¡nh nÃ y vÃ o Main? (Enter = CÃ³, n = KhÃ´ng): " confirm
confirm=${confirm:-y}

if [[ "$confirm" =~ ^[Yy]$ ]]; then
  git checkout main
  git reset --hard origin/$LATEST_BRANCH
  git push origin main --force
  echo "âœ… XONG! ÄÃ£ Ä‘áº©y $LATEST_BRANCH lÃªn Production."
  echo "â˜• Má»i sáº¿p uá»‘ng cÃ  phÃª!"
else
  echo "âŒ ÄÃ£ há»§y."
fi
