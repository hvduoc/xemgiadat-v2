(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();var w=Uint8Array,D=Uint16Array,Je=Int32Array,xe=new w([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Te=new w([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ge=new w([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ce=function(r,e){for(var t=new D(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new Je(t[30]),n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)i[o]=o-t[n]<<5|n;return{b:t,r:i}},Ee=Ce(xe,2),Le=Ee.b,qe=Ee.r;Le[28]=258,qe[258]=28;var Qe=Ce(Te,0),Xe=Qe.b,X=new D(32768);for(var g=0;g<32768;++g){var M=(g&43690)>>1|(g&21845)<<1;M=(M&52428)>>2|(M&13107)<<2,M=(M&61680)>>4|(M&3855)<<4,X[g]=((M&65280)>>8|(M&255)<<8)>>1}var Z=(function(r,e,t){for(var n=r.length,i=0,o=new D(e);i<n;++i)r[i]&&++o[r[i]-1];var a=new D(e);for(i=1;i<e;++i)a[i]=a[i-1]+o[i-1]<<1;var s;if(t){s=new D(1<<e);var f=15-e;for(i=0;i<n;++i)if(r[i])for(var c=i<<4|r[i],h=e-r[i],l=a[r[i]-1]++<<h,u=l|(1<<h)-1;l<=u;++l)s[X[l]>>f]=c}else for(s=new D(n),i=0;i<n;++i)r[i]&&(s[i]=X[a[r[i]-1]++]>>15-r[i]);return s}),I=new w(288);for(var g=0;g<144;++g)I[g]=8;for(var g=144;g<256;++g)I[g]=9;for(var g=256;g<280;++g)I[g]=7;for(var g=280;g<288;++g)I[g]=8;var Ue=new w(32);for(var g=0;g<32;++g)Ue[g]=5;var Ye=Z(I,9,1),et=Z(Ue,5,1),q=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},T=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},Q=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},tt=function(r){return(r+7)/8|0},rt=function(r,e,t){return(t==null||t>r.length)&&(t=r.length),new w(r.subarray(e,t))},nt=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],y=function(r,e,t){var n=new Error(e||nt[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,y),!t)throw n;return n},te=function(r,e,t,n){var i=r.length,o=0;if(!i||e.f&&!e.l)return t||new w(0);var a=!t,s=a||e.i!=2,f=e.i;a&&(t=new w(i*3));var c=function(ye){var we=t.length;if(ye>we){var be=new w(Math.max(we*2,ye));be.set(t),t=be}},h=e.f||0,l=e.p||0,u=e.b||0,m=e.l,C=e.d,b=e.m,O=e.n,k=i*8;do{if(!m){h=T(r,l,1);var $=T(r,l+1,3);if(l+=3,$)if($==1)m=Ye,C=et,b=9,O=5;else if($==2){var j=T(r,l,31)+257,ue=T(r,l+10,15)+4,he=j+T(r,l+5,31)+1;l+=14;for(var S=new w(he),V=new w(19),x=0;x<ue;++x)V[Ge[x]]=T(r,l+x*3,7);l+=ue*3;for(var fe=q(V),Ke=(1<<fe)-1,Ne=Z(V,fe,1),x=0;x<he;){var de=Ne[T(r,l,Ke)];l+=de&15;var E=de>>4;if(E<16)S[x++]=E;else{var z=0,R=0;for(E==16?(R=3+T(r,l,3),l+=2,z=S[x-1]):E==17?(R=3+T(r,l,7),l+=3):E==18&&(R=11+T(r,l,127),l+=7);R--;)S[x++]=z}}var ge=S.subarray(0,j),U=S.subarray(j);b=q(ge),O=q(U),m=Z(ge,b,1),C=Z(U,O,1)}else y(1);else{var E=tt(l)+4,K=r[E-4]|r[E-3]<<8,N=E+K;if(N>i){f&&y(0);break}s&&c(u+K),t.set(r.subarray(E,N),u),e.b=u+=K,e.p=l=N*8,e.f=h;continue}if(l>k){f&&y(0);break}}s&&c(u+131072);for(var je=(1<<b)-1,Ve=(1<<O)-1,W=l;;W=l){var z=m[Q(r,l)&je],A=z>>4;if(l+=z&15,l>k){f&&y(0);break}if(z||y(2),A<256)t[u++]=A;else if(A==256){W=l,m=null;break}else{var ve=A-254;if(A>264){var x=A-257,H=xe[x];ve=T(r,l,(1<<H)-1)+Le[x],l+=H}var J=C[Q(r,l)&Ve],G=J>>4;J||y(3),l+=J&15;var U=Xe[G];if(G>3){var H=Te[G];U+=Q(r,l)&(1<<H)-1,l+=H}if(l>k){f&&y(0);break}s&&c(u+131072);var me=u+ve;if(u<U){var pe=o-U,We=Math.min(U,me);for(pe+u<0&&y(3);u<We;++u)t[u]=n[pe+u]}for(;u<me;++u)t[u]=t[u-U]}}e.l=m,e.p=W,e.b=u,e.f=h,m&&(h=1,e.m=b,e.d=C,e.n=O)}while(!h);return u!=t.length&&a?rt(t,0,u):t.subarray(0,u)},it=new w(0),ot=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&y(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)},at=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},st=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&y(6,"invalid zlib data"),(r[1]>>5&1)==1&&y(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function lt(r,e){return te(r,{i:2},e,e)}function ct(r,e){var t=ot(r);return t+8>r.length&&y(6,"invalid gzip data"),te(r.subarray(t,-8),{i:2},new w(at(r)),e)}function ut(r,e){return te(r.subarray(st(r),-4),{i:2},e,e)}function ht(r,e){return r[0]==31&&r[1]==139&&r[2]==8?ct(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?lt(r,e):ut(r,e)}var ft=typeof TextDecoder<"u"&&new TextDecoder,dt=0;try{ft.decode(it,{stream:!0}),dt=1}catch{}var gt=Object.defineProperty,_=Math.pow,d=(r,e)=>gt(r,"name",{value:e,configurable:!0}),v=(r,e,t)=>new Promise((n,i)=>{var o=f=>{try{s(t.next(f))}catch(c){i(c)}},a=f=>{try{s(t.throw(f))}catch(c){i(c)}},s=f=>f.done?n(f.value):Promise.resolve(f.value).then(o,a);s((t=t.apply(r,e)).next())}),vt=d((r,e)=>{let t=!1,n="",i=L.GridLayer.extend({createTile:d((o,a)=>{let s=document.createElement("img"),f=new AbortController,c=f.signal;return s.cancel=()=>{f.abort()},t||(r.getHeader().then(h=>{h.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):h.tileType===2?n="image/png":h.tileType===3?n="image/jpeg":h.tileType===4?n="image/webp":h.tileType===5&&(n="image/avif")}),t=!0),r.getZxy(o.z,o.x,o.y,c).then(h=>{if(h){let l=new Blob([h.data],{type:n}),u=window.URL.createObjectURL(l);s.src=u,s.cancel=void 0,a(void 0,s)}}).catch(h=>{if(h.name!=="AbortError")throw h}),s},"createTile"),_removeTile:d(function(o){let a=this._tiles[o];a&&(a.el.cancel&&a.el.cancel(),a.el.width=0,a.el.height=0,a.el.deleted=!0,L.DomUtil.remove(a.el),delete this._tiles[o],this.fire("tileunload",{tile:a.el,coords:this._keyToTileCoords(o)}))},"_removeTile")});return new i(e)},"leafletRasterLayer"),mt=d(r=>(e,t)=>{if(t instanceof AbortController)return r(e,t);let n=new AbortController;return r(e,n).then(i=>t(void 0,i.data,i.cacheControl||"",i.expires||""),i=>t(i)).catch(i=>t(i)),{cancel:d(()=>n.abort(),"cancel")}},"v3compat"),Me=class{constructor(e){this.tilev4=d((t,n)=>v(this,null,function*(){if(t.type==="json"){let m=t.url.substr(10),C=this.tiles.get(m);if(C||(C=new ee(m),this.tiles.set(m,C)),this.metadata)return{data:yield C.getTileJson(t.url)};let b=yield C.getHeader();return{data:{tiles:[`${t.url}/{z}/{x}/{y}`],minzoom:b.minZoom,maxzoom:b.maxZoom,bounds:[b.minLon,b.minLat,b.maxLon,b.maxLat]}}}let i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),o=t.url.match(i);if(!o)throw new Error("Invalid PMTiles protocol URL");let a=o[1],s=this.tiles.get(a);s||(s=new ee(a),this.tiles.set(a,s));let f=o[2],c=o[3],h=o[4],l=yield s.getHeader(),u=yield s==null?void 0:s.getZxy(+f,+c,+h,n.signal);return u?{data:new Uint8Array(u.data),cacheControl:u.cacheControl,expires:u.expires}:l.tileType===1?{data:new Uint8Array}:{data:null}}),"tilev4"),this.tile=mt(this.tilev4),this.tiles=new Map,this.metadata=(e==null?void 0:e.metadata)||!1}add(e){this.tiles.set(e.source.getKey(),e)}get(e){return this.tiles.get(e)}};d(Me,"Protocol");var Y=Me;function Pe(r,e){return(e>>>0)*4294967296+(r>>>0)}d(Pe,"toNum");function ze(r,e){let t=e.buf,n=t[e.pos++],i=(n&112)>>4;if(n<128||(n=t[e.pos++],i|=(n&127)<<3,n<128)||(n=t[e.pos++],i|=(n&127)<<10,n<128)||(n=t[e.pos++],i|=(n&127)<<17,n<128)||(n=t[e.pos++],i|=(n&127)<<24,n<128)||(n=t[e.pos++],i|=(n&1)<<31,n<128))return Pe(r,i);throw new Error("Expected varint not more than 10 bytes")}d(ze,"readVarintRemainder");function P(r){let e=r.buf,t=e[r.pos++],n=t&127;return t<128||(t=e[r.pos++],n|=(t&127)<<7,t<128)||(t=e[r.pos++],n|=(t&127)<<14,t<128)||(t=e[r.pos++],n|=(t&127)<<21,t<128)?n:(t=e[r.pos],n|=(t&15)<<28,ze(n,r))}d(P,"readVarint");function re(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);let i=e[0];e[0]=e[1],e[1]=i}}d(re,"rotate");function Ae(r,e){let t=_(2,r),n=e,i=e,o=e,a=[0,0],s=1;for(;s<t;)n=1&o/2,i=1&(o^n),re(s,a,n,i),a[0]+=s*n,a[1]+=s*i,o=o/4,s*=2;return[r,a[0],a[1]]}d(Ae,"idOnLevel");var pt=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function ne(r,e,t){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>_(2,r)-1||t>_(2,r)-1)throw Error("tile x/y outside zoom level bounds");let n=pt[r],i=_(2,r),o=0,a=0,s=0,f=[e,t],c=i/2;for(;c>0;)o=(f[0]&c)>0?1:0,a=(f[1]&c)>0?1:0,s+=c*c*(3*o^a),re(c,f,o,a),c=c/2;return n+s}d(ne,"zxyToTileId");function De(r){let e=0;for(let t=0;t<27;t++){let n=(1<<t)*(1<<t);if(e+n>r)return Ae(t,r-e);e+=n}throw Error("Tile zoom level exceeds max safe number limit (26)")}d(De,"tileIdToZxy");var Oe=(r=>(r[r.Unknown=0]="Unknown",r[r.None=1]="None",r[r.Gzip=2]="Gzip",r[r.Brotli=3]="Brotli",r[r.Zstd=4]="Zstd",r))(Oe||{});function F(r,e){return v(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return ht(new Uint8Array(r));let t=new Response(r).body;if(!t)throw Error("Failed to read response stream");let n=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw Error("Compression method not supported")})}d(F,"defaultDecompress");var Se=(r=>(r[r.Unknown=0]="Unknown",r[r.Mvt=1]="Mvt",r[r.Png=2]="Png",r[r.Jpeg=3]="Jpeg",r[r.Webp=4]="Webp",r[r.Avif=5]="Avif",r))(Se||{});function ie(r){return r===1?".mvt":r===2?".png":r===3?".jpg":r===4?".webp":r===5?".avif":""}d(ie,"tileTypeExt");var yt=127;function oe(r,e){let t=0,n=r.length-1;for(;t<=n;){let i=n+t>>1,o=e-r[i].tileId;if(o>0)t=i+1;else if(o<0)n=i-1;else return r[i]}return n>=0&&(r[n].runLength===0||e-r[n].tileId<r[n].runLength)?r[n]:null}d(oe,"findTile");var He=class{constructor(e){this.file=e}getKey(){return this.file.name}getBytes(e,t){return v(this,null,function*(){return{data:yield this.file.slice(e,e+t).arrayBuffer()}})}};d(He,"FileSource");var wt=He,Ze=class{constructor(e,t=new Headers){this.url=e,this.customHeaders=t,this.mustReload=!1;let n="";"navigator"in globalThis&&(n=globalThis.navigator.userAgent||"");let i=n.indexOf("Windows")>-1,o=/Chrome|Chromium|Edg|OPR|Brave/.test(n);this.chromeWindowsNoCache=!1,i&&o&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(e){this.customHeaders=e}getBytes(e,t,n,i){return v(this,null,function*(){let o,a;n?a=n:(o=new AbortController,a=o.signal);let s=new Headers(this.customHeaders);s.set("range",`bytes=${e}-${e+t-1}`);let f;this.mustReload?f="reload":this.chromeWindowsNoCache&&(f="no-store");let c=yield fetch(this.url,{signal:a,cache:f,headers:s});if(e===0&&c.status===416){let u=c.headers.get("Content-Range");if(!u||!u.startsWith("bytes */"))throw Error("Missing content-length on 416 response");let m=+u.substr(8);c=yield fetch(this.url,{signal:a,cache:"reload",headers:{range:`bytes=0-${m-1}`}})}let h=c.headers.get("Etag");if(h!=null&&h.startsWith("W/")&&(h=null),c.status===416||i&&h&&h!==i)throw this.mustReload=!0,new B(`Server returned non-matching ETag ${i} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(c.status>=300)throw Error(`Bad response code: ${c.status}`);let l=c.headers.get("Content-Length");if(c.status===200&&(!l||+l>t))throw o&&o.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield c.arrayBuffer(),etag:h||void 0,cacheControl:c.headers.get("Cache-Control")||void 0,expires:c.headers.get("Expires")||void 0}})}};d(Ze,"FetchSource");var _e=Ze;function p(r,e){let t=r.getUint32(e+4,!0),n=r.getUint32(e+0,!0);return t*_(2,32)+n}d(p,"getUint64");function ae(r,e){let t=new DataView(r),n=t.getUint8(7);if(n>3)throw Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:p(t,8),rootDirectoryLength:p(t,16),jsonMetadataOffset:p(t,24),jsonMetadataLength:p(t,32),leafDirectoryOffset:p(t,40),leafDirectoryLength:p(t,48),tileDataOffset:p(t,56),tileDataLength:p(t,64),numAddressedTiles:p(t,72),numTileEntries:p(t,80),numTileContents:p(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}d(ae,"bytesToHeader");function se(r){let e={buf:new Uint8Array(r),pos:0},t=P(e),n=[],i=0;for(let o=0;o<t;o++){let a=P(e);n.push({tileId:i+a,offset:0,length:0,runLength:1}),i+=a}for(let o=0;o<t;o++)n[o].runLength=P(e);for(let o=0;o<t;o++)n[o].length=P(e);for(let o=0;o<t;o++){let a=P(e);a===0&&o>0?n[o].offset=n[o-1].offset+n[o-1].length:n[o].offset=a-1}return n}d(se,"deserializeIndex");var Ie=class extends Error{};d(Ie,"EtagMismatch");var B=Ie;function le(r,e){return v(this,null,function*(){let t=yield r.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let n=t.data.slice(0,yt),i=ae(n,t.etag),o=t.data.slice(i.rootDirectoryOffset,i.rootDirectoryOffset+i.rootDirectoryLength),a=`${r.getKey()}|${i.etag||""}|${i.rootDirectoryOffset}|${i.rootDirectoryLength}`,s=se(yield e(o,i.internalCompression));return[i,[a,s.length,s]]})}d(le,"getHeaderAndRoot");function ce(r,e,t,n,i){return v(this,null,function*(){let o=yield r.getBytes(t,n,void 0,i.etag),a=yield e(o.data,i.internalCompression),s=se(a);if(s.length===0)throw new Error("Empty directory is invalid");return s})}d(ce,"getDirectory");var Re=class{constructor(e=100,t=!0,n=F){this.cache=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=n}getHeader(e){return v(this,null,function*(){let t=e.getKey(),n=this.cache.get(t);if(n)return n.lastUsed=this.counter++,n.data;let i=yield le(e,this.decompress);return i[1]&&this.cache.set(i[1][0],{lastUsed:this.counter++,data:i[1][2]}),this.cache.set(t,{lastUsed:this.counter++,data:i[0]}),this.prune(),i[0]})}getDirectory(e,t,n,i){return v(this,null,function*(){let o=`${e.getKey()}|${i.etag||""}|${t}|${n}`,a=this.cache.get(o);if(a)return a.lastUsed=this.counter++,a.data;let s=yield ce(e,this.decompress,t,n,i);return this.cache.set(o,{lastUsed:this.counter++,data:s}),this.prune(),s})}prune(){if(this.cache.size>this.maxCacheEntries){let e=1/0,t;this.cache.forEach((n,i)=>{n.lastUsed<e&&(e=n.lastUsed,t=i)}),t&&this.cache.delete(t)}}invalidate(e){return v(this,null,function*(){this.cache.delete(e.getKey())})}};d(Re,"ResolvedValueCache");var bt=Re,Be=class{constructor(e=100,t=!0,n=F){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=n}getHeader(e){return v(this,null,function*(){let t=e.getKey(),n=this.cache.get(t);if(n)return n.lastUsed=this.counter++,yield n.data;let i=new Promise((o,a)=>{le(e,this.decompress).then(s=>{s[1]&&this.cache.set(s[1][0],{lastUsed:this.counter++,data:Promise.resolve(s[1][2])}),o(s[0]),this.prune()}).catch(s=>{a(s)})});return this.cache.set(t,{lastUsed:this.counter++,data:i}),i})}getDirectory(e,t,n,i){return v(this,null,function*(){let o=`${e.getKey()}|${i.etag||""}|${t}|${n}`,a=this.cache.get(o);if(a)return a.lastUsed=this.counter++,yield a.data;let s=new Promise((f,c)=>{ce(e,this.decompress,t,n,i).then(h=>{f(h),this.prune()}).catch(h=>{c(h)})});return this.cache.set(o,{lastUsed:this.counter++,data:s}),s})}prune(){if(this.cache.size>=this.maxCacheEntries){let e=1/0,t;this.cache.forEach((n,i)=>{n.lastUsed<e&&(e=n.lastUsed,t=i)}),t&&this.cache.delete(t)}}invalidate(e){return v(this,null,function*(){let t=e.getKey();if(this.invalidations.get(t))return yield this.invalidations.get(t);this.cache.delete(e.getKey());let n=new Promise((i,o)=>{this.getHeader(e).then(a=>{i(),this.invalidations.delete(t)}).catch(a=>{o(a)})});this.invalidations.set(t,n)})}};d(Be,"SharedPromiseCache");var Fe=Be,ke=class{constructor(e,t,n){typeof e=="string"?this.source=new _e(e):this.source=e,n?this.decompress=n:this.decompress=F,t?this.cache=t:this.cache=new Fe}getHeader(){return v(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(e,t,n,i){return v(this,null,function*(){let o=ne(e,t,n),a=yield this.cache.getHeader(this.source);if(e<a.minZoom||e>a.maxZoom)return;let s=a.rootDirectoryOffset,f=a.rootDirectoryLength;for(let c=0;c<=3;c++){let h=yield this.cache.getDirectory(this.source,s,f,a),l=oe(h,o);if(l){if(l.runLength>0){let u=yield this.source.getBytes(a.tileDataOffset+l.offset,l.length,i,a.etag);return{data:yield this.decompress(u.data,a.tileCompression),cacheControl:u.cacheControl,expires:u.expires}}s=a.leafDirectoryOffset+l.offset,f=l.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(e,t,n,i){return v(this,null,function*(){try{return yield this.getZxyAttempt(e,t,n,i)}catch(o){if(o instanceof B)return this.cache.invalidate(this.source),yield this.getZxyAttempt(e,t,n,i);throw o}})}getMetadataAttempt(){return v(this,null,function*(){let e=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength,void 0,e.etag),n=yield this.decompress(t.data,e.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(n))})}getMetadata(){return v(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(e){if(e instanceof B)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw e}})}getTileJson(e){return v(this,null,function*(){let t=yield this.getHeader(),n=yield this.getMetadata(),i=ie(t.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${e}/{z}/{x}/{y}${i}`],vector_layers:n.vector_layers,attribution:n.attribution,description:n.description,name:n.name,version:n.version,bounds:[t.minLon,t.minLat,t.maxLon,t.maxLat],center:[t.centerLon,t.centerLat,t.centerZoom],minzoom:t.minZoom,maxzoom:t.maxZoom}})}};d(ke,"PMTiles");var ee=ke;const $e=Object.freeze(Object.defineProperty({__proto__:null,Compression:Oe,EtagMismatch:B,FetchSource:_e,FileSource:wt,PMTiles:ee,Protocol:Y,ResolvedValueCache:bt,SharedPromiseCache:Fe,TileType:Se,bytesToHeader:ae,findTile:oe,getUint64:p,leafletRasterLayer:vt,readVarint:P,tileIdToZxy:De,tileTypeExt:ie,zxyToTileId:ne},Symbol.toStringTag,{value:"Module"}));window.pmtiles=$e;window.__trackCDN("pmtiles",!0);console.log("[PMTiles] ✓ Loaded via ES module:",$e);if(window.maplibregl){const r=new Y;window.maplibregl.addProtocol("pmtiles",r.tile),window.__pmtiles_registered=!0,console.log("[PMTiles] ✓ Protocol registered")}else{const r=setInterval(()=>{if(window.maplibregl){clearInterval(r);const e=new Y;window.maplibregl.addProtocol("pmtiles",e.tile),window.__pmtiles_registered=!0,console.log("[PMTiles] ✓ Protocol registered (delayed)")}},100)}
