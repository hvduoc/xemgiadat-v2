(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();(function(){console.log("[INIT] Extended utilities loading..."),window.__CDN_LOAD_STATUS__||(window.__CDN_LOAD_STATUS__={},window.__trackCDN=function(i,n){window.__CDN_LOAD_STATUS__[i]=n,console.log("[CDN] "+i+": "+(n?"✓ OK":"✗ FAILED"))});function r(){window.__REAL_LOCATION__||(window.__REAL_LOCATION__={href:window.location.href,origin:window.location.origin,protocol:window.location.protocol,host:window.location.host,hostname:window.location.hostname,pathname:window.location.pathname,search:window.location.search,hash:window.location.hash,toString:function(){return window.location.href}});var i={href:"https://xemgiadat.com/",origin:"https://xemgiadat.com",protocol:"https:",host:"xemgiadat.com",hostname:"xemgiadat.com",pathname:"/",search:"",hash:"",toString:function(){return"https://xemgiadat.com/"}};try{var n=["href","origin","protocol","host","hostname","pathname","search","hash"];n.forEach(function(o){Object.defineProperty(window.location,o,{get:function(){return i[o]},configurable:!0})}),console.log("[INIT] ✓ window.location override successful")}catch(o){window.__SAFE_LOCATION__=i,console.warn("[INIT] window.location override failed, using fallback:",o.message)}}r();var e={apiKey:"AIzaSyDu9tYpJdMPT7Hvk2_Ug8XHwxRQXoakRfs",authDomain:"xemgiadat-dfe15.firebaseapp.com",projectId:"xemgiadat-dfe15",storageBucket:"xemgiadat-dfe15.appspot.com",messagingSenderId:"361952598367",appId:"1:361952598367:web:c1e2e3b1a6d5d8c797beea",measurementId:"G-XT932D9N1N"},t=null;window.__initFirebase=function(){return t||(t=(async function(){if(!window.firebase)throw new Error("Firebase SDK not available");(!window.firebase.apps||window.firebase.apps.length===0)&&window.firebase.initializeApp(e);var i=window.firebase.auth(),n=window.firebase.firestore(),o=window.firebase.storage();if(window.firebase.analytics)try{window.firebase.analytics()}catch(a){console.warn("[Firebase] Analytics init skipped:",(a==null?void 0:a.message)||a)}return window.__firebaseAuth=i,window.__firebaseDb=n,window.__firebaseStorage=o,{auth:i,db:n,storage:o}})(),t)},window.__ensureUserDocument=async function(i){var h,c;var n=window.__firebaseDb;if(!(!n||!i)){var o=n.collection("users").doc(i.uid),a=await o.get(),s=window.firebase.firestore.FieldValue.serverTimestamp();a.exists?await o.update({updatedAt:s,displayName:i.displayName||((h=a.data())==null?void 0:h.displayName)||"",photoURL:i.photoURL||((c=a.data())==null?void 0:c.photoURL)||""}):await o.set({displayName:i.displayName||"",email:i.email||"",phone:"",contactFacebook:"",photoURL:i.photoURL||"",createdAt:s,updatedAt:s})}},window.__initFirebaseUi=function(i){if(!window.firebaseui||!window.firebase)return console.error("[FirebaseUI] SDK not available"),null;var n={callbacks:{signInSuccessWithAuthResult:function(o,a){return console.log("[Auth] Sign in success:",o.user.email),!1},signInFailure:function(o){return console.warn("[Auth] Sign in failed:",o),Promise.resolve()}},signInFlow:"popup",credentialHelper:window.firebaseui.auth.CredentialHelper.NONE,signInOptions:[window.firebase.auth.GoogleAuthProvider.PROVIDER_ID,window.firebase.auth.FacebookAuthProvider.PROVIDER_ID,window.firebase.auth.EmailAuthProvider.PROVIDER_ID],tosUrl:"#",privacyPolicyUrl:"#"};return window.__firebaseUiInstance||(window.__firebaseUiInstance=new window.firebaseui.auth.AuthUI(window.firebase.auth())),window.__firebaseUiInstance.start(i,n),window.__firebaseUiInstance},console.log("[INIT] ✓ Core utilities initialized")})();var y=Uint8Array,O=Uint16Array,Ge=Int32Array,_e=new y([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),xe=new y([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Je=new y([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Te=function(r,e){for(var t=new O(31),i=0;i<31;++i)t[i]=e+=1<<r[i-1];for(var n=new Ge(t[30]),i=1;i<30;++i)for(var o=t[i];o<t[i+1];++o)n[o]=o-t[i]<<5|i;return{b:t,r:n}},Ue=Te(_e,2),Le=Ue.b,Xe=Ue.r;Le[28]=258,Xe[258]=28;var qe=Te(xe,0),Qe=qe.b,Q=new O(32768);for(var g=0;g<32768;++g){var C=(g&43690)>>1|(g&21845)<<1;C=(C&52428)>>2|(C&13107)<<2,C=(C&61680)>>4|(C&3855)<<4,Q[g]=((C&65280)>>8|(C&255)<<8)>>1}var R=(function(r,e,t){for(var i=r.length,n=0,o=new O(e);n<i;++n)r[n]&&++o[r[n]-1];var a=new O(e);for(n=1;n<e;++n)a[n]=a[n-1]+o[n-1]<<1;var s;if(t){s=new O(1<<e);var h=15-e;for(n=0;n<i;++n)if(r[n])for(var c=n<<4|r[n],f=e-r[n],l=a[r[n]-1]++<<f,u=l|(1<<f)-1;l<=u;++l)s[Q[l]>>h]=c}else for(s=new O(i),n=0;n<i;++n)r[n]&&(s[n]=Q[a[r[n]-1]++]>>15-r[n]);return s}),N=new y(288);for(var g=0;g<144;++g)N[g]=8;for(var g=144;g<256;++g)N[g]=9;for(var g=256;g<280;++g)N[g]=7;for(var g=280;g<288;++g)N[g]=8;var Ae=new y(32);for(var g=0;g<32;++g)Ae[g]=5;var Ye=R(N,9,1),et=R(Ae,5,1),X=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},x=function(r,e,t){var i=e/8|0;return(r[i]|r[i+1]<<8)>>(e&7)&t},q=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},tt=function(r){return(r+7)/8|0},rt=function(r,e,t){return(t==null||t>r.length)&&(t=r.length),new y(r.subarray(e,t))},it=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],p=function(r,e,t){var i=new Error(e||it[r]);if(i.code=r,Error.captureStackTrace&&Error.captureStackTrace(i,p),!t)throw i;return i},te=function(r,e,t,i){var n=r.length,o=0;if(!n||e.f&&!e.l)return t||new y(0);var a=!t,s=a||e.i!=2,h=e.i;a&&(t=new y(n*3));var c=function(pe){var ye=t.length;if(pe>ye){var be=new y(Math.max(ye*2,pe));be.set(t),t=be}},f=e.f||0,l=e.p||0,u=e.b||0,m=e.l,T=e.d,b=e.m,P=e.n,Z=n*8;do{if(!m){f=x(r,l,1);var B=x(r,l+1,3);if(l+=3,B)if(B==1)m=Ye,T=et,b=9,P=5;else if(B==2){var V=x(r,l,31)+257,ue=x(r,l+10,15)+4,he=V+x(r,l+5,31)+1;l+=14;for(var S=new y(he),j=new y(19),_=0;_<ue;++_)j[Je[_]]=x(r,l+_*3,7);l+=ue*3;for(var fe=X(j),Ke=(1<<fe)-1,$e=R(j,fe,1),_=0;_<he;){var de=$e[x(r,l,Ke)];l+=de&15;var U=de>>4;if(U<16)S[_++]=U;else{var I=0,F=0;for(U==16?(F=3+x(r,l,3),l+=2,I=S[_-1]):U==17?(F=3+x(r,l,7),l+=3):U==18&&(F=11+x(r,l,127),l+=7);F--;)S[_++]=I}}var ge=S.subarray(0,V),A=S.subarray(V);b=X(ge),P=X(A),m=R(ge,b,1),T=R(A,P,1)}else p(1);else{var U=tt(l)+4,K=r[U-4]|r[U-3]<<8,$=U+K;if($>n){h&&p(0);break}s&&c(u+K),t.set(r.subarray(U,$),u),e.b=u+=K,e.p=l=$*8,e.f=f;continue}if(l>Z){h&&p(0);break}}s&&c(u+131072);for(var Ve=(1<<b)-1,je=(1<<P)-1,W=l;;W=l){var I=m[q(r,l)&Ve],D=I>>4;if(l+=I&15,l>Z){h&&p(0);break}if(I||p(2),D<256)t[u++]=D;else if(D==256){W=l,m=null;break}else{var we=D-254;if(D>264){var _=D-257,M=_e[_];we=x(r,l,(1<<M)-1)+Le[_],l+=M}var G=T[q(r,l)&je],J=G>>4;G||p(3),l+=G&15;var A=Qe[J];if(J>3){var M=xe[J];A+=q(r,l)&(1<<M)-1,l+=M}if(l>Z){h&&p(0);break}s&&c(u+131072);var me=u+we;if(u<A){var ve=o-A,We=Math.min(A,me);for(ve+u<0&&p(3);u<We;++u)t[u]=i[ve+u]}for(;u<me;++u)t[u]=t[u-A]}}e.l=m,e.p=W,e.b=u,e.f=f,m&&(f=1,e.m=b,e.d=T,e.n=P)}while(!f);return u!=t.length&&a?rt(t,0,u):t.subarray(0,u)},nt=new y(0),ot=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&p(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!r[t++]);return t+(e&2)},at=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},st=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&p(6,"invalid zlib data"),(r[1]>>5&1)==1&&p(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function lt(r,e){return te(r,{i:2},e,e)}function ct(r,e){var t=ot(r);return t+8>r.length&&p(6,"invalid gzip data"),te(r.subarray(t,-8),{i:2},new y(at(r)),e)}function ut(r,e){return te(r.subarray(st(r),-4),{i:2},e,e)}function ht(r,e){return r[0]==31&&r[1]==139&&r[2]==8?ct(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?lt(r,e):ut(r,e)}var ft=typeof TextDecoder<"u"&&new TextDecoder,dt=0;try{ft.decode(nt,{stream:!0}),dt=1}catch{}var gt=Object.defineProperty,z=Math.pow,d=(r,e)=>gt(r,"name",{value:e,configurable:!0}),w=(r,e,t)=>new Promise((i,n)=>{var o=h=>{try{s(t.next(h))}catch(c){n(c)}},a=h=>{try{s(t.throw(h))}catch(c){n(c)}},s=h=>h.done?i(h.value):Promise.resolve(h.value).then(o,a);s((t=t.apply(r,e)).next())}),wt=d((r,e)=>{let t=!1,i="",n=L.GridLayer.extend({createTile:d((o,a)=>{let s=document.createElement("img"),h=new AbortController,c=h.signal;return s.cancel=()=>{h.abort()},t||(r.getHeader().then(f=>{f.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):f.tileType===2?i="image/png":f.tileType===3?i="image/jpeg":f.tileType===4?i="image/webp":f.tileType===5&&(i="image/avif")}),t=!0),r.getZxy(o.z,o.x,o.y,c).then(f=>{if(f){let l=new Blob([f.data],{type:i}),u=window.URL.createObjectURL(l);s.src=u,s.cancel=void 0,a(void 0,s)}}).catch(f=>{if(f.name!=="AbortError")throw f}),s},"createTile"),_removeTile:d(function(o){let a=this._tiles[o];a&&(a.el.cancel&&a.el.cancel(),a.el.width=0,a.el.height=0,a.el.deleted=!0,L.DomUtil.remove(a.el),delete this._tiles[o],this.fire("tileunload",{tile:a.el,coords:this._keyToTileCoords(o)}))},"_removeTile")});return new n(e)},"leafletRasterLayer"),mt=d(r=>(e,t)=>{if(t instanceof AbortController)return r(e,t);let i=new AbortController;return r(e,i).then(n=>t(void 0,n.data,n.cacheControl||"",n.expires||""),n=>t(n)).catch(n=>t(n)),{cancel:d(()=>i.abort(),"cancel")}},"v3compat"),Ce=class{constructor(e){this.tilev4=d((t,i)=>w(this,null,function*(){if(t.type==="json"){let m=t.url.substr(10),T=this.tiles.get(m);if(T||(T=new ee(m),this.tiles.set(m,T)),this.metadata)return{data:yield T.getTileJson(t.url)};let b=yield T.getHeader();return{data:{tiles:[`${t.url}/{z}/{x}/{y}`],minzoom:b.minZoom,maxzoom:b.maxZoom,bounds:[b.minLon,b.minLat,b.maxLon,b.maxLat]}}}let n=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),o=t.url.match(n);if(!o)throw new Error("Invalid PMTiles protocol URL");let a=o[1],s=this.tiles.get(a);s||(s=new ee(a),this.tiles.set(a,s));let h=o[2],c=o[3],f=o[4],l=yield s.getHeader(),u=yield s==null?void 0:s.getZxy(+h,+c,+f,i.signal);return u?{data:new Uint8Array(u.data),cacheControl:u.cacheControl,expires:u.expires}:l.tileType===1?{data:new Uint8Array}:{data:null}}),"tilev4"),this.tile=mt(this.tilev4),this.tiles=new Map,this.metadata=(e==null?void 0:e.metadata)||!1}add(e){this.tiles.set(e.source.getKey(),e)}get(e){return this.tiles.get(e)}};d(Ce,"Protocol");var Y=Ce;function Ee(r,e){return(e>>>0)*4294967296+(r>>>0)}d(Ee,"toNum");function Ie(r,e){let t=e.buf,i=t[e.pos++],n=(i&112)>>4;if(i<128||(i=t[e.pos++],n|=(i&127)<<3,i<128)||(i=t[e.pos++],n|=(i&127)<<10,i<128)||(i=t[e.pos++],n|=(i&127)<<17,i<128)||(i=t[e.pos++],n|=(i&127)<<24,i<128)||(i=t[e.pos++],n|=(i&1)<<31,i<128))return Ee(r,n);throw new Error("Expected varint not more than 10 bytes")}d(Ie,"readVarintRemainder");function E(r){let e=r.buf,t=e[r.pos++],i=t&127;return t<128||(t=e[r.pos++],i|=(t&127)<<7,t<128)||(t=e[r.pos++],i|=(t&127)<<14,t<128)||(t=e[r.pos++],i|=(t&127)<<21,t<128)?i:(t=e[r.pos],i|=(t&15)<<28,Ie(i,r))}d(E,"readVarint");function re(r,e,t,i){if(i===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);let n=e[0];e[0]=e[1],e[1]=n}}d(re,"rotate");function De(r,e){let t=z(2,r),i=e,n=e,o=e,a=[0,0],s=1;for(;s<t;)i=1&o/2,n=1&(o^i),re(s,a,i,n),a[0]+=s*i,a[1]+=s*n,o=o/4,s*=2;return[r,a[0],a[1]]}d(De,"idOnLevel");var vt=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function ie(r,e,t){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>z(2,r)-1||t>z(2,r)-1)throw Error("tile x/y outside zoom level bounds");let i=vt[r],n=z(2,r),o=0,a=0,s=0,h=[e,t],c=n/2;for(;c>0;)o=(h[0]&c)>0?1:0,a=(h[1]&c)>0?1:0,s+=c*c*(3*o^a),re(c,h,o,a),c=c/2;return i+s}d(ie,"zxyToTileId");function Oe(r){let e=0;for(let t=0;t<27;t++){let i=(1<<t)*(1<<t);if(e+i>r)return De(t,r-e);e+=i}throw Error("Tile zoom level exceeds max safe number limit (26)")}d(Oe,"tileIdToZxy");var Pe=(r=>(r[r.Unknown=0]="Unknown",r[r.None=1]="None",r[r.Gzip=2]="Gzip",r[r.Brotli=3]="Brotli",r[r.Zstd=4]="Zstd",r))(Pe||{});function k(r,e){return w(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return ht(new Uint8Array(r));let t=new Response(r).body;if(!t)throw Error("Failed to read response stream");let i=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(i).arrayBuffer()}throw Error("Compression method not supported")})}d(k,"defaultDecompress");var Se=(r=>(r[r.Unknown=0]="Unknown",r[r.Mvt=1]="Mvt",r[r.Png=2]="Png",r[r.Jpeg=3]="Jpeg",r[r.Webp=4]="Webp",r[r.Avif=5]="Avif",r))(Se||{});function ne(r){return r===1?".mvt":r===2?".png":r===3?".jpg":r===4?".webp":r===5?".avif":""}d(ne,"tileTypeExt");var pt=127;function oe(r,e){let t=0,i=r.length-1;for(;t<=i;){let n=i+t>>1,o=e-r[n].tileId;if(o>0)t=n+1;else if(o<0)i=n-1;else return r[n]}return i>=0&&(r[i].runLength===0||e-r[i].tileId<r[i].runLength)?r[i]:null}d(oe,"findTile");var Me=class{constructor(e){this.file=e}getKey(){return this.file.name}getBytes(e,t){return w(this,null,function*(){return{data:yield this.file.slice(e,e+t).arrayBuffer()}})}};d(Me,"FileSource");var yt=Me,Re=class{constructor(e,t=new Headers){this.url=e,this.customHeaders=t,this.mustReload=!1;let i="";"navigator"in globalThis&&(i=globalThis.navigator.userAgent||"");let n=i.indexOf("Windows")>-1,o=/Chrome|Chromium|Edg|OPR|Brave/.test(i);this.chromeWindowsNoCache=!1,n&&o&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(e){this.customHeaders=e}getBytes(e,t,i,n){return w(this,null,function*(){let o,a;i?a=i:(o=new AbortController,a=o.signal);let s=new Headers(this.customHeaders);s.set("range",`bytes=${e}-${e+t-1}`);let h;this.mustReload?h="reload":this.chromeWindowsNoCache&&(h="no-store");let c=yield fetch(this.url,{signal:a,cache:h,headers:s});if(e===0&&c.status===416){let u=c.headers.get("Content-Range");if(!u||!u.startsWith("bytes */"))throw Error("Missing content-length on 416 response");let m=+u.substr(8);c=yield fetch(this.url,{signal:a,cache:"reload",headers:{range:`bytes=0-${m-1}`}})}let f=c.headers.get("Etag");if(f!=null&&f.startsWith("W/")&&(f=null),c.status===416||n&&f&&f!==n)throw this.mustReload=!0,new H(`Server returned non-matching ETag ${n} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(c.status>=300)throw Error(`Bad response code: ${c.status}`);let l=c.headers.get("Content-Length");if(c.status===200&&(!l||+l>t))throw o&&o.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield c.arrayBuffer(),etag:f||void 0,cacheControl:c.headers.get("Cache-Control")||void 0,expires:c.headers.get("Expires")||void 0}})}};d(Re,"FetchSource");var ze=Re;function v(r,e){let t=r.getUint32(e+4,!0),i=r.getUint32(e+0,!0);return t*z(2,32)+i}d(v,"getUint64");function ae(r,e){let t=new DataView(r),i=t.getUint8(7);if(i>3)throw Error(`Archive is spec version ${i} but this library supports up to spec version 3`);return{specVersion:i,rootDirectoryOffset:v(t,8),rootDirectoryLength:v(t,16),jsonMetadataOffset:v(t,24),jsonMetadataLength:v(t,32),leafDirectoryOffset:v(t,40),leafDirectoryLength:v(t,48),tileDataOffset:v(t,56),tileDataLength:v(t,64),numAddressedTiles:v(t,72),numTileEntries:v(t,80),numTileContents:v(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}d(ae,"bytesToHeader");function se(r){let e={buf:new Uint8Array(r),pos:0},t=E(e),i=[],n=0;for(let o=0;o<t;o++){let a=E(e);i.push({tileId:n+a,offset:0,length:0,runLength:1}),n+=a}for(let o=0;o<t;o++)i[o].runLength=E(e);for(let o=0;o<t;o++)i[o].length=E(e);for(let o=0;o<t;o++){let a=E(e);a===0&&o>0?i[o].offset=i[o-1].offset+i[o-1].length:i[o].offset=a-1}return i}d(se,"deserializeIndex");var Ne=class extends Error{};d(Ne,"EtagMismatch");var H=Ne;function le(r,e){return w(this,null,function*(){let t=yield r.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let i=t.data.slice(0,pt),n=ae(i,t.etag),o=t.data.slice(n.rootDirectoryOffset,n.rootDirectoryOffset+n.rootDirectoryLength),a=`${r.getKey()}|${n.etag||""}|${n.rootDirectoryOffset}|${n.rootDirectoryLength}`,s=se(yield e(o,n.internalCompression));return[n,[a,s.length,s]]})}d(le,"getHeaderAndRoot");function ce(r,e,t,i,n){return w(this,null,function*(){let o=yield r.getBytes(t,i,void 0,n.etag),a=yield e(o.data,n.internalCompression),s=se(a);if(s.length===0)throw new Error("Empty directory is invalid");return s})}d(ce,"getDirectory");var Fe=class{constructor(e=100,t=!0,i=k){this.cache=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=i}getHeader(e){return w(this,null,function*(){let t=e.getKey(),i=this.cache.get(t);if(i)return i.lastUsed=this.counter++,i.data;let n=yield le(e,this.decompress);return n[1]&&this.cache.set(n[1][0],{lastUsed:this.counter++,data:n[1][2]}),this.cache.set(t,{lastUsed:this.counter++,data:n[0]}),this.prune(),n[0]})}getDirectory(e,t,i,n){return w(this,null,function*(){let o=`${e.getKey()}|${n.etag||""}|${t}|${i}`,a=this.cache.get(o);if(a)return a.lastUsed=this.counter++,a.data;let s=yield ce(e,this.decompress,t,i,n);return this.cache.set(o,{lastUsed:this.counter++,data:s}),this.prune(),s})}prune(){if(this.cache.size>this.maxCacheEntries){let e=1/0,t;this.cache.forEach((i,n)=>{i.lastUsed<e&&(e=i.lastUsed,t=n)}),t&&this.cache.delete(t)}}invalidate(e){return w(this,null,function*(){this.cache.delete(e.getKey())})}};d(Fe,"ResolvedValueCache");var bt=Fe,He=class{constructor(e=100,t=!0,i=k){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=i}getHeader(e){return w(this,null,function*(){let t=e.getKey(),i=this.cache.get(t);if(i)return i.lastUsed=this.counter++,yield i.data;let n=new Promise((o,a)=>{le(e,this.decompress).then(s=>{s[1]&&this.cache.set(s[1][0],{lastUsed:this.counter++,data:Promise.resolve(s[1][2])}),o(s[0]),this.prune()}).catch(s=>{a(s)})});return this.cache.set(t,{lastUsed:this.counter++,data:n}),n})}getDirectory(e,t,i,n){return w(this,null,function*(){let o=`${e.getKey()}|${n.etag||""}|${t}|${i}`,a=this.cache.get(o);if(a)return a.lastUsed=this.counter++,yield a.data;let s=new Promise((h,c)=>{ce(e,this.decompress,t,i,n).then(f=>{h(f),this.prune()}).catch(f=>{c(f)})});return this.cache.set(o,{lastUsed:this.counter++,data:s}),s})}prune(){if(this.cache.size>=this.maxCacheEntries){let e=1/0,t;this.cache.forEach((i,n)=>{i.lastUsed<e&&(e=i.lastUsed,t=n)}),t&&this.cache.delete(t)}}invalidate(e){return w(this,null,function*(){let t=e.getKey();if(this.invalidations.get(t))return yield this.invalidations.get(t);this.cache.delete(e.getKey());let i=new Promise((n,o)=>{this.getHeader(e).then(a=>{n(),this.invalidations.delete(t)}).catch(a=>{o(a)})});this.invalidations.set(t,i)})}};d(He,"SharedPromiseCache");var ke=He,Ze=class{constructor(e,t,i){typeof e=="string"?this.source=new ze(e):this.source=e,i?this.decompress=i:this.decompress=k,t?this.cache=t:this.cache=new ke}getHeader(){return w(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(e,t,i,n){return w(this,null,function*(){let o=ie(e,t,i),a=yield this.cache.getHeader(this.source);if(e<a.minZoom||e>a.maxZoom)return;let s=a.rootDirectoryOffset,h=a.rootDirectoryLength;for(let c=0;c<=3;c++){let f=yield this.cache.getDirectory(this.source,s,h,a),l=oe(f,o);if(l){if(l.runLength>0){let u=yield this.source.getBytes(a.tileDataOffset+l.offset,l.length,n,a.etag);return{data:yield this.decompress(u.data,a.tileCompression),cacheControl:u.cacheControl,expires:u.expires}}s=a.leafDirectoryOffset+l.offset,h=l.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(e,t,i,n){return w(this,null,function*(){try{return yield this.getZxyAttempt(e,t,i,n)}catch(o){if(o instanceof H)return this.cache.invalidate(this.source),yield this.getZxyAttempt(e,t,i,n);throw o}})}getMetadataAttempt(){return w(this,null,function*(){let e=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength,void 0,e.etag),i=yield this.decompress(t.data,e.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(i))})}getMetadata(){return w(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(e){if(e instanceof H)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw e}})}getTileJson(e){return w(this,null,function*(){let t=yield this.getHeader(),i=yield this.getMetadata(),n=ne(t.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${e}/{z}/{x}/{y}${n}`],vector_layers:i.vector_layers,attribution:i.attribution,description:i.description,name:i.name,version:i.version,bounds:[t.minLon,t.minLat,t.maxLon,t.maxLat],center:[t.centerLon,t.centerLat,t.centerZoom],minzoom:t.minZoom,maxzoom:t.maxZoom}})}};d(Ze,"PMTiles");var ee=Ze;const Be=Object.freeze(Object.defineProperty({__proto__:null,Compression:Pe,EtagMismatch:H,FetchSource:ze,FileSource:yt,PMTiles:ee,Protocol:Y,ResolvedValueCache:bt,SharedPromiseCache:ke,TileType:Se,bytesToHeader:ae,findTile:oe,getUint64:v,leafletRasterLayer:wt,readVarint:E,tileIdToZxy:Oe,tileTypeExt:ne,zxyToTileId:ie},Symbol.toStringTag,{value:"Module"}));window.pmtiles=Be;window.__trackCDN("pmtiles",!0);console.log("[PMTiles] ✓ Loaded via ES module:",Be);if(window.maplibregl){const r=new Y;window.maplibregl.addProtocol("pmtiles",r.tile),window.__pmtiles_registered=!0,console.log("[PMTiles] ✓ Protocol registered")}else{const r=setInterval(()=>{if(window.maplibregl){clearInterval(r);const e=new Y;window.maplibregl.addProtocol("pmtiles",e.tile),window.__pmtiles_registered=!0,console.log("[PMTiles] ✓ Protocol registered (delayed)")}},100)}
